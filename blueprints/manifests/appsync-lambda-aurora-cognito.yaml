# Blueprint Manifest: appsync-lambda-aurora-cognito
# GraphQL API with AppSync, Lambda resolvers, Aurora database, and Cognito authentication
name: appsync-lambda-aurora-cognito
description: GraphQL API with AppSync, Lambda resolvers, Aurora database, and Cognito authentication
version: 1.0.0

snippets:
  - id: cognito-user-pool
    name: Cognito User Pool
    description: Cognito user pool for authentication
    template: cognito-user-pool.tftpl
    output_file: modules/auth/main.tf
    variables:
      - name: user_pool_name
        type: string
        required: true
        description: Name of the Cognito User Pool
        pattern: "^[a-z0-9-]+$"
      
      - name: user_pool_client_name
        type: string
        required: true
        description: Name of the Cognito User Pool Client
        pattern: "^[a-z0-9-]+$"
      
      - name: password_minimum_length
        type: number
        required: false
        default: 8
        description: Minimum password length
      
      - name: password_require_lowercase
        type: boolean
        required: false
        default: false
        description: Require lowercase characters
      
      - name: password_require_uppercase
        type: boolean
        required: false
        default: false
        description: Require uppercase characters
      
      - name: password_require_numbers
        type: boolean
        required: false
        default: false
        description: Require numbers
      
      - name: password_require_symbols
        type: boolean
        required: false
        default: false
        description: Require symbols
      
      - name: mfa_configuration
        type: string
        required: false
        default: "OFF"
        description: MFA configuration
        enum: ["OFF", "ON", "OPTIONAL"]
      
      - name: access_token_validity
        type: number
        required: false
        default: 1
        description: Access token validity in hours
      
      - name: id_token_validity
        type: number
        required: false
        default: 1
        description: ID token validity in hours
      
      - name: refresh_token_validity
        type: number
        required: false
        default: 30
        description: Refresh token validity in days

  - id: lambda-function
    name: Lambda Resolver
    description: Lambda function as AppSync resolver
    template: lambda-function.tftpl
    output_file: modules/compute/main.tf
    variables:
      - name: function_name
        type: string
        required: true
        description: Lambda function name
        pattern: "^[a-z0-9-]+$"
      
      - name: runtime
        type: string
        required: false
        default: "nodejs20.x"
        description: Lambda runtime
        enum: ["nodejs18.x", "nodejs20.x", "python3.11", "python3.12"]
      
      - name: handler
        type: string
        required: true
        description: Lambda handler (e.g., index.handler)
      
      - name: timeout
        type: number
        required: false
        default: 30
        description: Lambda timeout in seconds
      
      - name: memory_size
        type: number
        required: false
        default: 256
        description: Lambda memory size in MB
        enum: [128, 256, 512, 1024, 2048, 3008]
      
      - name: environment_variables
        type: string
        required: false
        default: ""
        description: Environment variables as JSON string
