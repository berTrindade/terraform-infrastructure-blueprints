# Blueprint Manifest: apigw-lambda-rds
# Serverless REST API with RDS PostgreSQL
name: apigw-lambda-rds
description: Serverless REST API with RDS PostgreSQL
version: 1.0.0

snippets:
  - id: rds-module
    name: RDS PostgreSQL Module
    description: Complete RDS module with ephemeral passwords (Flow A)
    template: rds-module.tftpl
    output_file: modules/data/main.tf
    variables:
      - name: db_identifier
        type: string
        required: true
        description: RDS instance identifier (e.g., myapp-dev-db)
        pattern: "^[a-z0-9-]+$"
      
      - name: db_name
        type: string
        required: true
        default: "mydb"
        description: Database name
      
      - name: engine_version
        type: string
        required: false
        default: "15.4"
        description: PostgreSQL engine version
      
      - name: instance_class
        type: string
        required: false
        default: "db.t3.micro"
        description: RDS instance class
        enum: ["db.t3.micro", "db.t3.small", "db.t3.medium", "db.t3.large"]
      
      - name: allocated_storage
        type: number
        required: false
        default: 20
        description: Initial storage allocation in GB
      
      - name: max_allocated_storage
        type: number
        required: false
        default: 100
        description: Maximum storage for autoscaling in GB
      
      - name: db_subnet_group_name
        type: string
        required: true
        description: Existing DB subnet group name
      
      - name: security_group_id
        type: string
        required: true
        description: Security group ID for RDS access
        pattern: "^sg-[a-z0-9]+$"
      
      - name: multi_az
        type: boolean
        required: false
        default: false
        description: Enable Multi-AZ deployment
      
      - name: backup_retention_period
        type: number
        required: false
        default: 7
        description: Days to retain backups
      
      - name: performance_insights_enabled
        type: boolean
        required: false
        default: false
        description: Enable Performance Insights
      
      - name: deletion_protection
        type: boolean
        required: false
        default: false
        description: Enable deletion protection
      
      - name: skip_final_snapshot
        type: boolean
        required: false
        default: true
        description: Skip final snapshot on deletion
      
      - name: apply_immediately
        type: boolean
        required: false
        default: true
        description: Apply changes immediately
    
    dependencies:
      - ephemeral-password

  - id: ephemeral-password
    name: Ephemeral Password Pattern
    description: Flow A ephemeral password generation pattern
    template: ephemeral-password.tftpl
    output_file: environments/dev/ephemeral-password.tf
    variables:
      - name: password_name
        type: string
        required: true
        default: "db"
        description: Name for the ephemeral password resource
      
      - name: password_length
        type: number
        required: false
        default: 32
        description: Password length
      
      - name: password_version
        type: number
        required: false
        default: 1
        description: Password version for rotation
