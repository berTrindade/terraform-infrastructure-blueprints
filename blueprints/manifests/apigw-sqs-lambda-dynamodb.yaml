# Blueprint Manifest: apigw-sqs-lambda-dynamodb
# REST API with SQS queue, Lambda processors, and DynamoDB storage
name: apigw-sqs-lambda-dynamodb
description: REST API with SQS queue, Lambda processors, and DynamoDB storage
version: 1.0.0

snippets:
  - id: sqs-queue
    name: SQS Queue with DLQ
    description: SQS queue with dead letter queue for reliable async processing
    template: sqs-queue.tftpl
    output_file: modules/queue/main.tf
    variables:
      - name: queue_name
        type: string
        required: true
        description: Name of the main SQS queue
        pattern: "^[a-z0-9-]+$"
      
      - name: dlq_name
        type: string
        required: true
        description: Name of the dead letter queue
        pattern: "^[a-z0-9-]+$"
      
      - name: message_retention_seconds
        type: number
        required: false
        default: 345600
        description: "Message retention period in seconds (default: 4 days)"
      
      - name: visibility_timeout_seconds
        type: number
        required: false
        default: 30
        description: Visibility timeout in seconds (should be > Lambda timeout)
      
      - name: max_receive_count
        type: number
        required: false
        default: 3
        description: Maximum number of receives before sending to DLQ

  - id: dynamodb-table
    name: DynamoDB Table
    description: DynamoDB table for processed data storage
    template: dynamodb-table.tftpl
    output_file: modules/data/main.tf
    variables:
      - name: table_name
        type: string
        required: true
        description: Name of the DynamoDB table
        pattern: "^[a-z0-9-]+$"
      
      - name: billing_mode
        type: string
        required: false
        default: "PAY_PER_REQUEST"
        description: Billing mode
        enum: ["PAY_PER_REQUEST", "PROVISIONED"]
      
      - name: hash_key
        type: string
        required: false
        default: "id"
        description: Hash key attribute name
      
      - name: enable_point_in_time_recovery
        type: boolean
        required: false
        default: true
        description: Enable point-in-time recovery
      
      - name: ttl_attribute_name
        type: string
        required: false
        default: ""
        description: TTL attribute name (empty to disable)
