# Blueprint Manifest: apigw-lambda-dynamodb
# Serverless API with Lambda and DynamoDB
name: apigw-lambda-dynamodb
description: Serverless API with Lambda and DynamoDB for fast data access
version: 1.0.0

snippets:
  - id: dynamodb-table
    name: DynamoDB Table
    description: DynamoDB table for items storage
    template: dynamodb-table.tftpl
    output_file: modules/data/main.tf
    variables:
      - name: table_name
        type: string
        required: true
        description: Name of the DynamoDB table
        pattern: "^[a-z0-9-]+$"
      
      - name: billing_mode
        type: string
        required: false
        default: "PAY_PER_REQUEST"
        description: Billing mode (PAY_PER_REQUEST or PROVISIONED)
        enum: ["PAY_PER_REQUEST", "PROVISIONED"]
      
      - name: hash_key
        type: string
        required: false
        default: "id"
        description: Hash key attribute name
      
      - name: enable_point_in_time_recovery
        type: boolean
        required: false
        default: true
        description: Enable point-in-time recovery
      
      - name: ttl_attribute_name
        type: string
        required: false
        default: ""
        description: TTL attribute name (empty to disable)

  - id: lambda-function
    name: Lambda Function
    description: Lambda function for API handler
    template: lambda-function.tftpl
    output_file: modules/api/lambda.tf
    variables:
      - name: function_name
        type: string
        required: true
        description: Lambda function name
        pattern: "^[a-z0-9-]+$"
      
      - name: runtime
        type: string
        required: false
        default: "nodejs20.x"
        description: Lambda runtime
        enum: ["nodejs18.x", "nodejs20.x", "python3.11", "python3.12"]
      
      - name: handler
        type: string
        required: true
        description: Lambda handler (e.g., index.handler)
      
      - name: timeout
        type: number
        required: false
        default: 30
        description: Lambda timeout in seconds
      
      - name: memory_size
        type: number
        required: false
        default: 256
        description: Lambda memory size in MB
        enum: [128, 256, 512, 1024, 2048, 3008]
      
      - name: environment_variables
        type: string
        required: false
        default: ""
        description: Environment variables as JSON string (e.g., '{"KEY":"value"}')
